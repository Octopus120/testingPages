<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Better Web Test - ServiceNow Mock</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { margin: 0; font-family: -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    header { background: #1a73e8; color: #fff; padding: 10px 16px; font-weight: 600; }
    .app { display: grid; grid-template-columns: 220px 1fr; min-height: 100vh; }
    nav { background: #f5f7fb; border-right: 1px solid #e4e7ee; padding: 12px; }
    nav h3 { font-size: 14px; margin: 8px 0; color: #333; }
    nav a { display: block; color: #1a73e8; text-decoration: none; padding: 6px 4px; border-radius: 4px; font-size: 14px; }
    nav a:hover { background: #eaf1fe; }
    main { position: relative; }
    #gsft_main { width: 100%; height: calc(100vh - 48px); border: 0; }
    .hint { font-size: 12px; color: #666; margin-top: 8px; }
  </style>
</head>
<body>
  <header>ServiceNow Mock â€” Better Web Testing Shell</header>
  <div class="app">
    <nav>
      <h3>Navigation</h3>
      <a href="incident_list.do.html" target="gsft_main">Incidents (List)</a>
      <a href="incident.do.html?sys_id=INC0000001" target="gsft_main">Sample Incident (Detail)</a>
      <div class="hint">Links load into the main iframe like ServiceNow.</div>
    </nav>
    <main>
      <iframe id="gsft_main" name="gsft_main" src="incident_list.do.html"></iframe>
    </main>
  </div>
  <script>
    (function () {
      function attachIframeLoad() {
        const frame = document.getElementById('gsft_main');
        if (!frame) return;

        const onLoaded = () => {
          try {
            const src = frame.src || frame.getAttribute('src');
            console.log('[BetterWeb Test] iframe loaded:', src);
          } catch (e) {
            console.log('[BetterWeb Test] iframe loaded (src unavailable)');
          }
        };

        // Listen for future navigations
        frame.addEventListener('load', onLoaded);

        // If the iframe content is already loaded before we bound the handler, fire once
        try {
          const doc = frame.contentDocument || (frame.contentWindow && frame.contentWindow.document);
          if (doc && (doc.readyState === 'complete' || doc.readyState === 'interactive')) {
            onLoaded();
          }
        } catch (e) {
          // Cross-origin would throw here; safe to ignore in our local test harness
        }

        // Optional: log clicks that target the iframe
        document.querySelectorAll('nav a[target="gsft_main"]').forEach(a => {
          a.addEventListener('click', () => {
            console.log('[BetterWeb Test] nav click ->', a.getAttribute('href'));
          });
        });
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', attachIframeLoad);
      } else {
        attachIframeLoad();
      }
    })();
  </script>
</body>
</html>
